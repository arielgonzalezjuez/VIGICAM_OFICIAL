{% load static %}
<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Vigi Cam</title>
    <link rel="shortcut icon" href="{% static "images/favicon.ico" %}" type="image/x-icon">
    <style>
      /* Reset and base styles */
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          Helvetica, Arial, sans-serif;
      }

      body {
        background-color: #1e1e1e;
        color: #e0e0e0;
        height: 100vh;
        display: flex;
        flex-direction: column;
        overflow: hidden;
      }

    /* Header */
.header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0 1rem;
  background-color: #1e2124;
  border-bottom: 1px solid #3a3e45;
  height: 60px;
  flex-shrink: 0;
  position: relative;
  z-index: 101; 
}

.logo-container {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  flex-grow: 1;
  cursor: pointer;

}

.logo-image {
  height: 50px; /* Ajusta según tu logo */
  margin: 0 0 0 10px;
  transition: transform 0.3s ease;
  object-fit: contain;
}

.logo-container:hover .logo-image {
  transform: scale(1.05);
}

.app-name {
  font-size: 1.1rem;
  font-weight: 600;
  color: #fff;
  text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
}

.app-name {
  font-weight: 600;
  font-size: 1.1rem;
}

.current-user {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  padding: 0.5rem 1rem;
  border-radius: 6px;
  background-color: #2b2e33;
  font-size: 0.9rem;
}

.current-user-avatar {
  width: 32px;
  height: 32px;
  border-radius: 50%;
  background-color: #e53935;
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  font-weight: bold;
  font-size: 0.9rem;
}

.menu-toggle {
  background: none;
  border: none;
  color: #e0e0e0;
  padding: 0.5rem;
  cursor: pointer;
  display: none; /* Oculto por defecto en desktop */
}

.menu-icon {
  width: 1.5rem;
  height: 1.5rem;
  stroke-width: 2;
}

/* Sidebar styles */
.sidebar-menu {
  display: flex;
  flex-direction: column;
  gap: 0.5rem; /* Menor espacio entre items */
  flex: 1;
  overflow-y: auto;
  padding: 1rem 0.5rem; /* Padding más compacto */
}

.menu-item {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  font-size: 0.9rem;
  padding: 0.75rem 1.25rem;
  cursor: pointer;
  white-space: nowrap;
  transition: all 0.2s ease;
  border-radius: 6px;
  margin: 0 0.5rem; /* Margen interno */
  color: #d1d5db; /* Color texto más claro */
}

.menu-item:hover {
  background-color: #34373d;
  transform: translateX(3px); /* Efecto de desplazamiento */
}

.menu-item.active {
  background-color: #3a3e45;
  border-left: 3px solid #e53935;
  font-weight: 500;
  color: white;
}

.menu-item .icon {
  width: 1.1rem;
  height: 1.1rem;
  stroke-width: 2;
  transition: color 0.2s;
}

.menu-item.active .icon {
  color: white;
}

/* Scrollbar personalizada */
.sidebar-menu::-webkit-scrollbar {
  width: 6px;
}

.sidebar-menu::-webkit-scrollbar-track {
  background: #25282d;
}

.sidebar-menu::-webkit-scrollbar-thumb {
  background-color: #3a3e45;
  border-radius: 3px;
}

      
/* Content area styles */
.content-area {
  flex: 1;
  display: flex;
  flex-direction: column;
  overflow: hidden;

background-color: #25282d;
}

.action-button {
        flex: 1;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.25rem;
        padding: 0.5rem;
        background-color: transparent;
        color: #e0e0e0;
        border: none;
        font-size: 0.75rem;
        cursor: pointer;
        height: 2rem;
      }

      .action-button:first-child {
        border-right: 1px solid #333;
      }

      .action-button:hover.add-button {
        background-color: #15803d;
        color: white;
      }

      .action-button:hover.edit-button {
        background-color: #0ea5e9;
        color: white;
      }

      .action-button:hover.delete-button {
        background-color: #b91c1c;
        color: white;
      }

      .search-container {
        padding: 0.5rem;
        border-bottom: 1px solid #333;
      }

      .search-box {
        position: relative;
      }

      .search-input {
        width: 100%;
        height: 1.75rem;
        background-color: #1e1e1e;
        border: 1px solid #444;
        color: #e0e0e0;
        padding: 0 1.75rem 0 0.5rem;
        font-size: 0.75rem;
        border-radius: 2px;
        transition: all 0.3s ease;
      }

      .search-icon {
        position: absolute;
        right: 0.5rem;
        top: 50%;
        transform: translateY(-50%);
        color: #888;
      }

      .search-input:focus {
        border-color: #60a5fa;
        outline: none;
      }
      
      .search-bar {
        width: 200px;
        height: 1.75rem;
        background-color: #333;
        border-radius: 2px;
        display: flex;
        align-items: center;
        padding: 0 0.5rem;
      }

      .no-results-message {
        color: #888;
        font-style: italic;
        text-align: center;
        padding: 1rem;
      }

      /* Estilos para los checkboxes - Versión modificada */
      .checkbox {
        --_clr-primary: #666;
        --_clr-hover: #dc2626;  /* Cambiado a rojo */
        --_clr-checked: #60a5fa;
        --_clr-current: var(--_clr-primary);
      
        appearance: none;
        outline: none;
        width: 0.875rem;
        height: 0.875rem;
        background: transparent;
        border: 1px solid var(--_clr-current);
        border-radius: 2px;
        display: grid;
        place-content: center;
        cursor: pointer;
        transition: all 150ms ease-in-out;
        margin-right: 0.5rem;
        position: relative;
      }

      .checkbox::after {
        content: "✓";
        opacity: 0;
        transition: opacity 150ms ease-in-out;
        color: var(--_clr-checked);
        font-size: 0.75rem;
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
      }

      /* Efecto hover en la fila completa */
      tbody tr:hover .checkbox {
        --_clr-current: var(--_clr-hover);
        border-color: var(--_clr-hover);
      }

      tbody tr:hover .checkbox::after {
        opacity: 0.5;
        color: var(--_clr-hover);
      }

      .checkbox:checked {
        --_clr-current: var(--_clr-checked);
        border-color: var(--_clr-checked);
      }

      .checkbox:checked::after {
        opacity: 1;
      }

      /* Estilos para las filas seleccionadas */
      tr.selected {
        background-color: rgba(96, 165, 250, 0.1) !important;
      }

      .checkbox-label {
        font-size: 0.75rem;
      }

      .tree-container {
        flex: 1;
        overflow: auto;
        padding: 0.25rem 0;
      }

      .tree-item {
        display: flex;
        align-items: center;
        padding: 0.125rem 0.5rem;
        cursor: pointer;
        font-size: 0.75rem;
      }

      .tree-item:hover {
        background-color: #2a2a2a;
      }

      .tree-icon {
        width: 0.875rem;
        height: 0.875rem;
        margin-right: 0.25rem;
        color: #888;
      }

      .folder-icon {
        width: 1rem;
        height: 1rem;
        margin-right: 0.25rem;
        color: #ca8a04;
      }

      .tree-child {
        margin-left: 1rem;
      }

       /* Main content styles */
       .main-container {
        display: flex;
        flex: 1;
        overflow: hidden;
      }

   

      .info-banner {
        background-color: #2a2a2a;
        padding: 0.5rem 1rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
        font-size: 0.875rem;
      }

      .info-icon {
        color: #60a5fa;
      }

      .action-toolbar {
        display: flex;
        align-items: center;
        padding: 0.5rem 1rem;
        border-bottom: 1px solid #333;
        gap: 1rem;
      }

      .toolbar-button {
        display: flex;
        align-items: center;
        gap: 0.25rem;
        font-size: 0.875rem;
        background: none;
        border: none;
        color: #e0e0e0;
        cursor: pointer;
      }

      .table-actions {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0.5rem 1rem;
        border-bottom: 1px solid #333;
      }

      .table-buttons {
        display: flex;
        align-items: center;
        gap: 0.75rem;
      }

      .table-button {
        display: flex;
        align-items: center;
        gap: 0.25rem;
        font-size: 0.75rem;
        background: none;
        border: none;
        color: #e0e0e0;
        cursor: pointer;
        height: 1.75rem;
        padding: 0 0.5rem;
        border-radius: 2px;
        transition: background-color 0.2s, color 0.2s;
      }

      .table-button:hover.add-button {
        background-color: #15803d;
        color: white;
      }

      .table-button:hover.edit-button {
        background-color: #0ea5e9;
        color: white;
      }

      .table-button:hover.delete-button {
        background-color: #b91c1c;
        color: white;
      }

      .filter-container {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        font-size: 0.75rem;
      }

      .table-container {
        flex: 1;
        overflow: auto;
      }

      table {
        width: 100%;
        border-collapse: collapse;
      }

      th,
      td {
        padding: 0.5rem 0.75rem;
        text-align: left;
        font-size: 0.75rem;
        border-left: 1px solid #333;
      }

      th:first-child,
      td:first-child {
        border-left: none;
      }

      th {
        background-color: #2a2a2a;
        font-weight: 500;
        border-bottom: 1px solid #333;
      }

      tbody tr {
        border-bottom: 1px solid #333;
        transition: background-color 0.2s ease;
      }

      tbody tr:hover {
        background-color: #2a2a2a;
      }

      tbody tr.selected {
        background-color: rgba(96, 165, 250, 0.1);
      }

      .blue-text {
        color: #60a5fa;
      }

      .totalTrabajadores {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0.5rem 1rem;
        border-top: 1px solid #333;
        background-color: #1e1e1e;
      }

      .records-info {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        font-size: 0.75rem;
      }

      .select-container {
        position: relative;
      }

      .select {
        height: 1.5rem;
        width: 4rem;
        background-color: #1e1e1e;
        border: 1px solid #444;
        color: #e0e0e0;
        font-size: 0.75rem;
        padding: 0 0.5rem;
        border-radius: 2px;
        appearance: none;
        cursor: pointer;
      }

      .select-arrow {
        position: absolute;
        right: 0.5rem;
        top: 50%;
        transform: translateY(-50%);
        pointer-events: none;
      }

      .windows-info {
        text-align: right;
      }

      .windows-title {
        font-size: 0.875rem;
        color: #888;
      }

      .windows-subtitle {
        font-size: 0.75rem;
        color: #888;
      }

      /* Taskbar styles */
      .taskbar {
        height: 2.5rem;
        background-color: #1e1e1e;
        border-top: 1px solid #333;
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0 0.5rem;
      }

      .taskbar-left {
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .windows-button {
        width: 1.75rem;
        height: 1.75rem;
        background-color: #333;
        border-radius: 2px;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .windows-icon {
        width: 1.25rem;
        height: 1.25rem;
        background-color: white;
      }

     

      .taskbar-right {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        font-size: 0.75rem;
      }

      /* Modal styles */
      .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: rgba(0, 0, 0, 0.7);
        display: flex;
        justify-content: flex-end;
        z-index: 1000;
        transition: opacity 0.3s ease-in-out;
      }

      .modal-container {
        background-color: #2a2a2a;
        width: 600px;
        height: 100%;
        display: flex;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
        ransition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      }

      .modal-sidebar {
        width: 200px;
        background-color: #252525;
        border-right: 1px solid #333;
        padding: 1rem;
      }

      .modal-content {
        flex: 1;
        display: flex;
        flex-direction: column;
      }

      .modal-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0.75rem 1rem;
        border-bottom: 1px solid #333;
      }

      .modal-title {
        font-size: 1.125rem;
        font-weight: 500;
      }

      .close-button {
        background: none;
        border: none;
        color: #888;
        cursor: pointer;
      }

      .close-button:hover {
        color: white;
      }

      .modal-body {
        flex: 1;
        overflow: auto;
        padding: 1rem;
      }

      .form-container {
        display: flex;
      }

      .form-left {
        flex: 1;
      }

      .form-header {
        display: flex;
        justify-content: space-between;
        margin-bottom: 1.5rem;
      }

      .form-title {
        font-size: 0.875rem;
      }

      .form-config {
        font-size: 0.875rem;
        color: #888;
      }

      .form-grid {
        display: grid;
        gap: 1rem;
      }

      .form-row {
        display: grid;
        grid-template-columns: 120px 1fr;
        align-items: center;
      }

      .form-row.align-top {
        align-items: start;
      }

      .form-label {
        display: flex;
        align-items: center;
        font-size: 0.875rem;
      }

      .required {
        color: #dc2626;
        margin-right: 0.25rem;
      }

      .form-input {
        height: 2rem;
        background-color: #1e1e1e;
        border: 1px solid #444;
        color: #e0e0e0;
        padding: 0 0.5rem;
        border-radius: 2px;
      }

      .radio-group {
        display: flex;
        align-items: center;
        gap: 1rem;
      }

      .radio-option {
        display: flex;
        align-items: center;
        gap: 0.375rem;
      }

      .radio {
        width: 0.875rem;
        height: 0.875rem;
        border: 1px solid #555;
        border-radius: 50%;
        position: relative;
        cursor: pointer;
      }

      .radio.checked::after {
        content: "";
        position: absolute;
        width: 0.5rem;
        height: 0.5rem;
        background-color: #e0e0e0;
        border-radius: 50%;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
      }

      .radio-label {
        font-size: 0.875rem;
      }

      .date-input-group {
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .date-input {
        flex: 1;
      }

      .calendar-button {
        height: 2rem;
        width: 2rem;
        display: flex;
        align-items: center;
        justify-content: center;
        background: none;
        border: none;
        color: #e0e0e0;
        cursor: pointer;
      }

      .extend-select {
        height: 2rem;
        width: 6rem;
        background-color: #1e1e1e;
        border: 1px solid #444;
        color: #e0e0e0;
        padding: 0 0.5rem;
        border-radius: 2px;
        appearance: none;
      }

      .textarea {
        min-height: 5rem;
        background-color: #1e1e1e;
        border: 1px solid #444;
        color: #e0e0e0;
        padding: 0.5rem;
        border-radius: 2px;
        resize: vertical;
      }

      .credential-section {
        margin-top: 2rem;
      }

      .section-header {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        cursor: pointer;
      }

      .section-title {
        font-size: 0.875rem;
        font-weight: 500;
      }

      .credential-content {
        margin-top: 1rem;
        padding-left: 1.5rem;
      }

      .credential-item {
        margin-bottom: 1.5rem;
      }

      .credential-label {
        font-size: 0.875rem;
        margin-bottom: 0.5rem;
      }

      .upload-box {
        width: 100px;
        height: 70px;
        border: 1px dashed #555;
        border-radius: 4px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
      }

      .plus-icon {
        color: #60a5fa;
        font-size: 2rem;
      }

      .form-right {
        width: 200px;
        display: flex;
        flex-direction: column;
        align-items: center;
      }

      .face-upload {
        width: 180px;
        height: 180px;
        border: 1px dashed #555;
        border-radius: 4px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 0.5rem;
        cursor: pointer;
      }

      .face-plus {
        font-size: 3rem;
        color: #888;
      }

      .add-face-button {
        font-size: 0.75rem;
        background: none;
        border: none;
        color: #e0e0e0;
        cursor: pointer;
        height: 1.75rem;
      }

      .modal-footer {
        border-top: 1px solid #333;
        padding: 1rem;
        display: flex;
        justify-content: flex-end;
        gap: 0.5rem;
      }

      .red-button {
        background-color: #dc2626;
        color: white;
        border: none;
        height: 2rem;
        padding: 0 1rem;
        border-radius: 2px;
        cursor: pointer;
      }

      .red-button:hover {
        background-color: #b91c1c;
      }

      .outline-button {
        background: none;
        color: #e0e0e0;
        border: 1px solid #444;
        height: 2rem;
        padding: 0 1rem;
        border-radius: 2px;
        cursor: pointer;
      }

      .outline-button:hover {
        background-color: #333;
      }

      /* Footer */
      .footer {
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 0.75rem;
  background-color: #1e2124;
  border-top: 1px solid #3a3e45;
  height: 50px;
  flex-shrink: 0;
}

.logout-icon {
  width: 1.5rem;
  height: 1.5rem;
  cursor: pointer;
  transition: transform 0.2s;
}

.logout-icon:hover {
  transform: scale(1.1);
}

      /* Responsive Styles */
@media (max-width: 1200px) {
  .sidebar {
    position: fixed;
    left: 0;
    top: 60px;
    bottom: 60px;
    transform: translateX(-100%);
    width: 280px;
    background-color: #1e2124; /* Más oscuro en móvil */
    border-right: none;
    box-shadow: 2px 0 15px rgba(0, 0, 0, 0.3);
    z-index: 999;
  }

  .sidebar.active {
    transform: translateX(0);
  }

  .menu-item {
    margin: 0 0.75rem;
  }

  .menu-toggle {
    display: block;
    margin-right: 0.5rem;
  }

  .content-area {
    margin-left: 0;
  }
}

@media (max-width: 992px) {
  .form-row {
    grid-template-columns: 1fr;
    gap: 0.5rem;
  }
  
  .form-label {
    justify-content: flex-start;
  }
  
  .modal-container {
    width: 100%;
  }
  
  .form-right {
    display: none;
  }
}

@media (max-width: 768px) {
  .logo-image {
    height: 30px;
    margin: 0 8px;
  }
  .app-name {
    font-size: 1rem;
  }
  .app-name {
    font-size: 1rem;
  }

  .user-dropdown {
    padding: 0.25rem 0.5rem;
    font-size: 0.875rem;
  }

  .table-actions {
    flex-direction: column;
    gap: 0.5rem;
    padding: 0.5rem;
  }
  
  .table-buttons {
    width: 100%;
    justify-content: space-between;
  }
  
  .search-container {
    width: 100%;
  }
  
  table {
    display: block;
    overflow-x: auto;
    white-space: nowrap;
  }
  
  .totalTrabajadores {
    flex-direction: column;
    gap: 0.5rem;
    align-items: flex-start;
  }
  
  .records-info {
    flex-direction: column;
    align-items: flex-start;
    gap: 0.25rem;
  }
}

@media (max-width: 576px) {
 .header {
    padding: 0 0.75rem;
  }

  .logo-container {
    gap: 0.5rem;
  }

  .menu-icon {
    width: 1.25rem;
    height: 1.25rem;
  }

  .logo {
    width: 1.5rem;
    height: 1.5rem;
  }

  .app-name {
    font-size: 0.9rem;
  }
  .modal-footer {
    flex-direction: column;
    gap: 0.5rem;
  }
  
  .modal-footer button {
    width: 100%;
  }
  
  .action-toolbar {
    flex-wrap: wrap;
    gap: 0.5rem;
  }
  
  .toolbar-button {
    flex: 1 0 45%;
  }
  
  .table-button {
    padding: 0 0.25rem;
    font-size: 0.7rem;
  }
  
  th, td {
    padding: 0.25rem;
    font-size: 0.7rem;
  }
}

@media (max-width: 480px) {
  .logo-image {
    height: 25px;
  }
  .app-name {
    font-size: 0.9rem;
  }
}
 /* Agrega estos estilos al CSS existente */
 .error-message {
    color: #dc2626;
    font-size: 0.75rem;
    margin-top: 0.25rem;
    display: none;
  }
  
  .form-input:invalid {
    border-color: #dc2626;
  }
  
  #facePreview {
    object-fit: cover;
    width: 100%;
    height: 100%;
  }
  /* Estilos para el icono de reloj */
.clock-icon {
  color: white; /* Icono blanco */
}

.date-input-group {
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.date-input {
  flex: 1;
}

.calendar-button {
  height: 2rem;
  width: 2rem;
  display: flex;
  align-items: center;
  justify-content: center;
  background: none;
  border: none;
  color: #e0e0e0;
  cursor: pointer;
  padding: 0;
}

.calendar-button:hover {
  color: white;
}

input[type="time"]::-webkit-calendar-picker-indicator {
  display: none;
}

/* Añade estos estilos al final de tu sección CSS */
.no-records {
  text-align: center;
  padding: 3rem;
  color: #888;
}

.no-records-icon {
  width: 4rem;
  height: 4rem;
  margin-bottom: 1rem;
  color: #555;
}

.no-records-message {
  font-size: 1rem;
  margin-bottom: 1rem;
}

.no-records-button {
  margin-top: 1rem;
  background-color: #dc2626;
  color: white;
  border: none;
  padding: 0.5rem 1rem;
  border-radius: 4px;
  cursor: pointer;
}

.no-records-button:hover {
  background-color: #b91c1c;
}

    /* Añade estos nuevos estilos */
      .avatar-cell {
        width: 60px;
        padding: 0.25rem !important;
      }
      
      .avatar-img {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        object-fit: cover;
        border: 2px solid #3a3e45;
        cursor: pointer;
      }
      
      .avatar-placeholder {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background-color: #2a2a2a;
        display: flex;
        align-items: center;
        justify-content: center;
        border: 2px solid #3a3e45;
        color: #888;
        font-size: 0.75rem;
      }

      .image-modal-overlay {
        position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: rgba(0, 0, 0, 0.9);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 2000;
}

.image-modal-overlay.active {
  opacity: 1;
  visibility: visible;
}

.image-modal-container {
  position: relative;
  max-width: 90%;
  max-height: 90%;
}

.image-wrapper {
  display: flex;
  justify-content: center;
  align-items: center;
  width: 100%;
  height: 100%;
}

#enlargedImage {
  max-height: 80vh;
  max-width: 80vw;
  object-fit: contain;
  display: none;
}

.image-placeholder {
  display: flex;
  flex-direction: column;
  align-items: center;
  color: #888;
  padding: 20px;
}

.image-placeholder svg {
  width: 80px;
  height: 80px;
  margin-bottom: 10px;
}

.image-close-button {
  position: absolute;
  top: 10px;
  right: 10px;
  background: #dc2626;
  border: none;
  border-radius: 50%;
  width: 40px;
  height: 40px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  color: white;
  z-index: 10;
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
}

.image-close-button:hover {
  background: #b91c1c;
}

.image-close-button svg {
  pointer-events: none;
}

.image-close-button svg {
  pointer-events: none;
}

.hidden {
  display: none !important;
}

th {
  cursor: pointer;
  user-select: none;
  position: relative;
}

th:hover {
  background-color: #333;
}

.sort-icon {
  margin-left: 5px;
  font-size: 0.75rem;
}

.sorted-asc .sort-icon {
  color: #60a5fa;
}

.sorted-desc .sort-icon {
  color: #60a5fa;
}
.sorted-asc {
  background-color: #2a2a2a;
}

.sorted-desc {
  background-color: #2a2a2a;
}

.sorted-asc .sort-icon {
  color: #60a5fa;
  content: ' ↑';
}

.sorted-desc .sort-icon {
  color: #60a5fa;
  content: ' ↓';
}
.sidebar {
  transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

 .no-access {
        position: relative;
        opacity: 0.5;
        pointer-events: none;
      }
      .no-access::after {
        content: "Sin acceso";
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background-color: rgba(255, 0, 0, 0.7);
        color: white;
        padding: 2px 8px;
        border-radius: 4px;
        font-size: 12px;
        z-index: 10;
      }
      
      .table-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  pointer-events: none;
}
    </style>
  </head>
  <body>
  <!-- Botón de menú hamburguesa -->

    <!-- Header -->
    <header class="header">
      <div class="logo-container" onclick="window.location.href='/'">
        <button class="menu-toggle">
          <!-- Icono del menú hamburguesa (mantenido) -->
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon" width="20" height="20">
            <line x1="3" y1="12" x2="21" y2="12"></line>
            <line x1="3" y1="6" x2="21" y2="6"></line>
            <line x1="3" y1="18" x2="21" y2="18"></line>
          </svg>
        </button>
        <!-- Nuevo logo con imagen -->
        <img src="{% static 'images/logo.png' %}" class="logo-image" alt="Logo Vigi Cam">
        <span class="app-name">Vigi Cam</span>
      </div>
      
      <div class="header-controls">
        <div class="current-user">
          <div class="current-user-avatar">{{ user.username.0|upper }}</div>
          <span>{{ user.username }}</span>
        </div>
      </div>
    </header>

    <!-- Main Content -->
    <div class="main-container">
      <!-- Sidebar -->
      <div class="sidebar">
        <div class="sidebar-menu">
          <div class="menu-item" onclick="window.location.href='/'">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
              class="icon"
              width="16"
              height="16"
            >
              <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
              <polyline points="9 22 9 12 15 12 15 22"></polyline>
            </svg>
            <span>Página Principal</span>
          </div>

          <div class="menu-item" onclick="window.location.href='{% url "cameras" %}'">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
              class="icon"
              width="16"
              height="16"
            >
              <path
                d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"
              ></path>
              <circle cx="12" cy="13" r="4"></circle>
            </svg>
            <span>Cámaras</span>
          </div>

          <div class="menu-item active" onclick="window.location.href='{% url "trabajadores" %}'">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
              class="icon"
              width="16"
              height="16"
            >
              <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
              <circle cx="9" cy="7" r="4"></circle>
              <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
              <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
            </svg>
            <span>Trabajadores</span>
          </div>

          <div class="menu-item {% if user.rol == 'usuario' or user.rol == 'usuario_con_beneficios' %}no-access{% endif %}" onclick="window.location.href='{% url "administrador" %}'">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
              class="icon"
              width="16"
              height="16"
            >
              <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
              <circle cx="8.5" cy="7" r="4"></circle>
              <line x1="20" y1="8" x2="20" y2="14"></line>
              <line x1="23" y1="11" x2="17" y2="11"></line>
            </svg>
            <span>Administrador</span>
          </div>
          <div class="menu-item" onclick="window.location.href='{% url "registro" %}'">
            <svg
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
            class="icon"
            width="16"
            height="16"
          >
            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
            <path d="M14 2v6h6"></path>
            <path d="M8 13v4"></path>
            <path d="M12 13v2"></path>
            <path d="M16 13v6"></path>
          </svg>
            <span>Registros</span>
          </div>
          <div class="menu-item" onclick="window.location.href='{% url "videos" %}'">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
              class="icon"
              width="16"
              height="16"
            >
              <polygon points="23 7 16 12 23 17 23 7"></polygon>
              <rect x="1" y="5" width="15" height="14" rx="2" ry="2"></rect>
            </svg>
            <span>Videos</span>
          </div>
        </div>
      </div>
      <!-- Content Area -->
      <div class="content-area">
        <!-- Table Actions -->
        <div class="table-actions">
          <div class="table-buttons">
            <button class="table-button add-button" id="tableAddButton" {% if user.rol != 'administrador' %}disabled{% endif %}>
              <span>+</span> Añadir
            </button>
            <button class="table-button edit-button" id="editButton" {% if user.rol != 'administrador' %}disabled{% endif %}>
              <svg class="icon" viewBox="0 0 24 24" width="14" height="14">
                <path
                  d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
                <path
                  d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
              </svg>
              Editar
            </button>

            <button class="table-button delete-button" id="deleteButton" {% if user.rol != 'administrador' %}disabled{% endif %}>
              <svg class="icon" viewBox="0 0 24 24" width="14" height="14">
                <path
                  d="M3 6h18"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
                <path
                  d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
              </svg>
              Eliminar
            </button>
          </div>
          <!-- Search -->
          <div class="search-container">
            <div class="search-box">
              <input type="text" class="search-input" id="searchInput" placeholder="Buscar" />
              <svg class="icon search-icon" viewBox="0 0 24 24" width="16" height="16">
                <circle cx="11" cy="11" r="8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <line x1="21" y1="21" x2="16.65" y2="16.65" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </div>
          </div>
        </div>

        <!-- Table -->
         <div class="table-container">
      <table>
        <thead>
          <tr>
            <th></th> 
            <th><input type="checkbox" class="checkbox" id="selectAllCheckbox"></th>
            <th>No.</th>
            <th class="sortable-header sorted-asc">Nombre <span class="sort-icon">↓</span></th>
            <th>Número de Carnet</th>
            <th>Cargo</th>
            <th>Horario de Entrada</th>
            <th>Horario de Salida</th>
          </tr>
        </thead>
        <tbody>
          {% if personas %}
            {% for persona in personas %}
            <tr data-id="{{ persona.pk }}" data-imagen-url="{% if persona.imagen %}{{ persona.imagen.url }}{% endif %}">
              <td class="avatar-cell" data-id="{{ persona.pk }}" data-imagen-url="{% if persona.imagen %}{{ persona.imagen.url }}{% endif %}">
                {% if persona.imagen %}
                  <img src="{{ persona.imagen.url }}" class="avatar-img" alt="{{ persona.nombre }}">
                {% else %}
                  <div class="avatar-placeholder">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                      <circle cx="12" cy="7" r="4"></circle>
                    </svg>
                  </div>
                {% endif %}
              </td>
              <td data-id="{{ persona.pk }}" data-imagen-url="{% if persona.imagen %}{{ persona.imagen.url }}{% endif %}">
                <input type="checkbox" class="checkbox row-checkbox" data-id="{{ persona.pk }}">
              </td>
              <td class="blue-text" data-id="{{ persona.pk }}" data-imagen-url="{% if persona.imagen %}{{ persona.imagen.url }}{% endif %}">{{ persona.pk }}</td>
              <td class="blue-text" data-id="{{ persona.pk }}" data-imagen-url="{% if persona.imagen %}{{ persona.imagen.url }}{% endif %}">{{ persona.nombre }}</td>
              <td data-id="{{ persona.pk }}" data-imagen-url="{% if persona.imagen %}{{ persona.imagen.url }}{% endif %}">{{ persona.carnet_identidad }}</td>
              <td data-id="{{ persona.pk }}" data-imagen-url="{% if persona.imagen %}{{ persona.imagen.url }}{% endif %}">{{ persona.cargo }}</td>
              <td data-id="{{ persona.pk }}" data-imagen-url="{% if persona.imagen %}{{ persona.imagen.url }}{% endif %}">{{ persona.horaE|time:"H:i" }}</td>
              <td data-id="{{ persona.pk }}" data-imagen-url="{% if persona.imagen %}{{ persona.imagen.url }}{% endif %}">{{ persona.horaS|time:"H:i" }}</td>
            </tr>
            {% endfor %}
          {% else %}
          <tr>
            <td colspan="8">
              <div class="no-records">
                <svg class="no-records-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
                  <line x1="12" y1="9" x2="12" y2="13"></line>
                  <line x1="12" y1="17" x2="12.01" y2="17"></line>
                </svg>
                <div class="no-records-message">No hay trabajadores registrados</div>
                <button class="no-records-button" id="addFirstWorkerButton">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 0.5rem;">
                    <line x1="12" y1="5" x2="12" y2="19"></line>
                    <line x1="5" y1="12" x2="19" y2="12"></line>
                  </svg>
                  Añadir primer trabajador
                </button>
              </div>
            </td>
          </tr>
          {% endif %}
        </tbody>
      </table>
    </div>

        <!-- Total Trabajadores -->
        <div class="totalTrabajadores">
          <div class="records-info">
            <span id="selectedCount">0 seleccionados</span>
            <span>Total {% if personas %}{{ personas|length }}{% else %}0{% endif %} Trabajador(es)</span>
            <div class="select-container">
              <select class="select">
                <option value="10">10</option>
                <option value="25">25</option>
                <option value="50" selected>50</option>
                <option value="100">100</option>
              </select>
              <svg class="icon select-arrow" viewBox="0 0 24 24" width="12" height="12">
                <path d="M6 9l6 6 6-6" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Footer -->
    <footer class="footer">
      <svg onclick="window.location.href='{% url "cerrarSession" %}'"
      xmlns="http://www.w3.org/2000/svg"
      viewBox="0 0 24 24"
      fill="none"
      stroke="currentColor"
      stroke-width="2"
      stroke-linecap="round"
      stroke-linejoin="round"
      class="logout-icon"
      width="20"
      height="20"
    >
      <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
      <polyline points="16 17 21 12 16 7"></polyline>
      <line x1="21" y1="12" x2="9" y2="12"></line>
    </svg>
    </footer>

    <div class="modal-overlay hidden" id="addPersonModal">
      <div class="modal-container">
        <div class="modal-content">
          <div class="modal-header">
            <h2 class="modal-title" id="modalTitle">Añadir Trabajador</h2>
            <button class="close-button" id="closeModalButton">
              <svg class="icon" viewBox="0 0 24 24" width="20" height="20">
                <line x1="18" y1="6" x2="6" y2="18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <line x1="6" y1="6" x2="18" y2="18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </button>
          </div>
    
          <!-- Formulario para Añadir -->
          <form method="post" id="addForm" class="modal-body" action="{% url 'registrar_persona' %}" enctype="multipart/form-data">
            {% csrf_token %}
            <div class="form-container">
              <div class="form-left">
                <div class="form-grid">
                  <!-- Carnet de Identidad -->
                  <div class="form-row">
                    <label class="form-label">
                      <span class="required">*</span>
                      <span>Carnet de Identidad</span>
                    </label>
                    <input 
                      type="text" 
                      class="form-input" 
                      maxlength="11"
                      minlength="11"
                      pattern="\d{11}"
                      title="El carnet debe contener exactamente 11 dígitos"
                      required
                      name="carnet_identidad"
                      id="add_carnet"
                    />
                    <div class="error-message" id="add_carnet_error"></div>
                  </div>
        
                  <!-- Nombre -->
                  <div class="form-row">
                    <label class="form-label">
                      <span class="required">*</span>
                      <span>Nombre</span>
                    </label>
   <input 
    type="text" 
    class="form-input" 
    required
    name="nombre"
    id="add_nombre"
    pattern="[A-Za-zÁÉÍÓÚáéíóúñÑ\s]+"
    minlength="2"
    maxlength="50"
    title="Mínimo 2 letras, máximo 50. Solo se permiten letras y espacios."
/>
                    <div class="error-message" id="add_nombre_error"></div>
                  </div>
        
                  <!-- Cargo -->
                  <div class="form-row">
                    <label class="form-label">
                      <span>Cargo</span>
                    </label>
                    <input 
                      type="text" 
                      class="form-input" 
                      name="cargo"
                      id="add_cargo"
                       pattern="[A-Za-zÁÉÍÓÚáéíóúñÑ ]+"
  title="Solo se permiten letras y espacios"
                    />
                  </div>
                  
                  <!-- Horario de Entrada -->
                  <div class="form-row">
                    <div class="form-label">
                      <span class="required">*</span>
                      <span>Hora de Entrada</span>
                    </div>
                    <div class="date-input-group">
                      <input
                        type="time"
                        class="form-input date-input"
                        required
                        name="horaE"
                        id="add_horaE"
                      />
                      <button class="calendar-button" type="button" onclick="this.previousElementSibling.showPicker()">
                        <svg class="icon clock-icon" viewBox="0 0 24 24" width="16" height="16">
                          <circle cx="12" cy="12" r="10" fill="none" stroke="currentColor" stroke-width="2"/>
                          <polyline points="12 6 12 12 16 14" fill="none" stroke="currentColor" stroke-width="2"/>
                        </svg>
                      </button>
                    </div>
                    <div class="error-message" id="add_horaE_error"></div>
                  </div>
    
                  <!-- Horario de Salida -->
                  <div class="form-row">
                    <div class="form-label">
                      <span class="required">*</span>
                      <span>Hora de Salida</span>
                    </div>
                    <div class="date-input-group">
                      <input
                        type="time"
                        class="form-input date-input"
                        required
                        name="horaS"
                        id="add_horaS"
                      />
                      <button class="calendar-button" type="button" onclick="this.previousElementSibling.showPicker()">
                        <svg class="icon clock-icon" viewBox="0 0 24 24" width="16" height="16">
                          <circle cx="12" cy="12" r="10" fill="none" stroke="currentColor" stroke-width="2"/>
                          <polyline points="12 6 12 12 16 14" fill="none" stroke="currentColor" stroke-width="2"/>
                        </svg>
                      </button>
                    </div>
                    <div class="error-message" id="add_horaS_error"></div>
                  </div>
                </div>
              </div>
        
              <!-- Imagen del trabajador -->
              <div class="form-right">
                <div class="face-upload" id="faceUploadAdd">
                  <span class="face-plus">+</span>
                  <img id="facePreviewAdd" class="hidden" style="max-width: 100%; max-height: 100%;"/>
                  <input 
                    type="file" 
                    id="imagenAdd"
                    accept="image/*"
                    class="hidden"
                    name="imagen"
                    required
                  />
                </div>
                <button type="button" class="add-face-button" id="addFaceButtonAdd">Añadir Imagen</button>
                <div class="error-message" id="add_imagen_error"></div>
              </div>
            </div>
        
            <div class="modal-footer">
              <button type="submit" class="red-button">Guardar</button>
              <button type="button" class="outline-button" id="cancelAddButton">Cancelar</button>
            </div>
          </form>
    
          <!-- Formulario para Editar (inicialmente oculto) -->
          <form method="post" id="editForm" class="modal-body hidden" action="" enctype="multipart/form-data">
            {% csrf_token %}
            <input type="hidden" name="_method" value="PUT">
            <div class="form-container">
              <div class="form-left">
                <div class="form-grid">
                  <!-- Carnet de Identidad -->
                  <div class="form-row">
                    <label class="form-label">
                      <span class="required">*</span>
                      <span>Carnet de Identidad</span>
                    </label>
                    <input 
                      type="text" 
                      class="form-input" 
                      maxlength="11"
                      minlength="11"
                      pattern="\d{11}"
                      title="El carnet debe contener exactamente 11 dígitos"
                      required
                      name="carnet_identidad"
                      id="edit_carnet"
                    />
                    <div class="error-message" id="edit_carnet_error"></div>
                  </div>
        
                  <!-- Nombre -->
                  <div class="form-row">
                    <label class="form-label">
                      <span class="required">*</span>
                      <span>Nombre</span>
                    </label>
                    <input 
                      type="text" 
                      class="form-input" 
                      required
                      name="nombre"
                      id="edit_nombre"
                        pattern="[A-Za-zÁÉÍÓÚáéíóúñÑ\s]+"
    minlength="2"
    maxlength="50"
    title="Mínimo 2 letras, máximo 50. Solo se permiten letras y espacios."

                    />
                    <div class="error-message" id="edit_nombre_error"></div>
                  </div>
        
                  <!-- Cargo -->
                  <div class="form-row">
                    <label class="form-label">
                      <span>Cargo</span>
                    </label>
                    <input 
                      type="text" 
                      class="form-input" 
                      name="cargo"
                      id="edit_cargo"
                        pattern="[A-Za-zÁÉÍÓÚáéíóúñÑ ]+"
  title="Solo se permiten letras y espacios"

                    />
                  </div>
                  
                  <!-- Horario de Entrada -->
                  <div class="form-row">
                    <div class="form-label">
                      <span class="required">*</span>
                      <span>Hora de Entrada</span>
                    </div>
                    <div class="date-input-group">
                      <input
                        type="time"
                        class="form-input date-input"
                        required
                        name="horaE"
                        id="edit_horaE"
                      />
                      <button class="calendar-button" type="button" onclick="this.previousElementSibling.showPicker()">
                        <svg class="icon clock-icon" viewBox="0 0 24 24" width="16" height="16">
                          <circle cx="12" cy="12" r="10" fill="none" stroke="currentColor" stroke-width="2"/>
                          <polyline points="12 6 12 12 16 14" fill="none" stroke="currentColor" stroke-width="2"/>
                        </svg>
                      </button>
                    </div>
                    <div class="error-message" id="edit_horaE_error"></div>
                  </div>
    
                  <!-- Horario de Salida -->
                  <div class="form-row">
                    <div class="form-label">
                      <span class="required">*</span>
                      <span>Hora de Salida</span>
                    </div>
                    <div class="date-input-group">
                      <input
                        type="time"
                        class="form-input date-input"
                        required
                        name="horaS"
                        id="edit_horaS"
                      />
                      <button class="calendar-button" type="button" onclick="this.previousElementSibling.showPicker()">
                        <svg class="icon clock-icon" viewBox="0 0 24 24" width="16" height="16">
                          <circle cx="12" cy="12" r="10" fill="none" stroke="currentColor" stroke-width="2"/>
                          <polyline points="12 6 12 12 16 14" fill="none" stroke="currentColor" stroke-width="2"/>
                        </svg>
                      </button>
                    </div>
                    <div class="error-message" id="edit_horaS_error"></div>
                  </div>
                </div>
              </div>
        
              <!-- Imagen del trabajador -->
              <div class="form-right">
                <div class="face-upload" id="faceUploadEdit">
                  <span class="face-plus">+</span>
                  <img id="facePreviewEdit" class="hidden" style="max-width: 100%; max-height: 100%;"/>
                  <input 
                    type="file" 
                    id="imagenEdit"
                    accept="image/*"
                    class="hidden"
                    name="imagen"
                  />
                </div>
                <button type="button" class="add-face-button" id="addFaceButtonEdit">Cambiar Imagen</button>
                <div class="error-message" id="edit_imagen_error"></div>
              </div>
            </div>
        
            <div class="modal-footer">
              <button type="submit" class="red-button">Actualizar</button>
              <button type="button" class="outline-button" id="cancelEditButton">Cancelar</button>
            </div>
          </form>
        </div>
      </div>
    </div>

<!-- Modal para ver imagen en grande -->
<div class="image-modal-overlay hidden" id="imageModal">
  <div class="image-modal-container">
    <button class="image-close-button" id="closeImageModalButton">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <line x1="18" y1="6" x2="6" y2="18" stroke="white" stroke-width="2"/>
        <line x1="6" y1="6" x2="18" y2="18" stroke="white" stroke-width="2"/>
      </svg>
    </button>
    <div class="image-wrapper">
      <img id="enlargedImage" src="" alt="Imagen ampliada" style="display: none;">
      <div class="image-placeholder">
        <svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 24 24" fill="none" stroke="#888" stroke-width="2">
          <circle cx="12" cy="7" r="4"/>
          <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
        </svg>
        <span>No hay imagen disponible</span>
      </div>
    </div>
  </div>
</div>
<script>
 // Variables globales
const addPersonModal = document.getElementById("addPersonModal");
const tableAddButton = document.getElementById("tableAddButton");
const editButton = document.getElementById("editButton");
const deleteButton = document.getElementById("deleteButton");
const closeModalButton = document.getElementById("closeModalButton");
const cancelAddButton = document.getElementById("cancelAddButton");
const cancelEditButton = document.getElementById("cancelEditButton");
const selectAllCheckbox = document.getElementById("selectAllCheckbox");
const rowCheckboxes = document.querySelectorAll(".row-checkbox");
const selectedCount = document.getElementById("selectedCount");
const tableRows = document.querySelectorAll("tbody tr");
const addForm = document.getElementById("addForm");
const editForm = document.getElementById("editForm");
const searchInput = document.getElementById("searchInput");

let sortDirection = 'asc';

// Inicialización
document.addEventListener('DOMContentLoaded', function() {
  initializeTable();
  setupEventListeners();
});

function initializeTable() {
  checkEmptyState();
  updateVisibleCount();
  sortTableByName();
  
  // Configurar botón "Añadir primer trabajador"
  const addFirstWorkerButton = document.getElementById('addFirstWorkerButton');
  if (addFirstWorkerButton) {
    addFirstWorkerButton.addEventListener('click', openAddModal);
  }
}

function setupEventListeners() {
  // Botones principales
  tableAddButton.addEventListener("click", openAddModal);
  editButton.addEventListener("click", handleEdit);
  deleteButton.addEventListener("click", handleDelete);
  closeModalButton.addEventListener("click", closeModal);
  cancelAddButton.addEventListener("click", closeModal);
  cancelEditButton.addEventListener("click", closeModal);
  selectAllCheckbox.addEventListener("change", toggleSelectAll);

  // Búsqueda
  searchInput.addEventListener('input', handleSearch);

  // Ordenamiento
  document.querySelector('th.sortable-header').addEventListener('click', toggleSort);

  // Imágenes
  document.getElementById('faceUploadAdd').addEventListener('click', () => document.getElementById('imagenAdd').click());
  document.getElementById('addFaceButtonAdd').addEventListener('click', () => document.getElementById('imagenAdd').click());
  document.getElementById('imagenAdd').addEventListener('change', handleImageUploadAdd);
  
  document.getElementById('faceUploadEdit').addEventListener('click', () => document.getElementById('imagenEdit').click());
  document.getElementById('addFaceButtonEdit').addEventListener('click', () => document.getElementById('imagenEdit').click());
  document.getElementById('imagenEdit').addEventListener('change', handleImageUploadEdit);

  // Validación de carnet
  document.querySelectorAll('input[name="carnet_identidad"]').forEach(input => {
    input.addEventListener('input', function() {
      this.value = this.value.replace(/[^0-9]/g, '');
      if (this.value.length > 11) {
        this.value = this.value.slice(0, 11);
      }
    });
  });

  // Selección de filas
  rowCheckboxes.forEach(checkbox => {
    checkbox.addEventListener("click", function(e) {
      e.stopPropagation();
      toggleRowSelection(this.getAttribute("data-id"));
      updateSelectionCount();
    });
  });

  tableRows.forEach(row => {
    row.addEventListener("click", function() {
      const checkbox = this.querySelector(".row-checkbox");
      checkbox.checked = !checkbox.checked;
      toggleRowSelection(checkbox.getAttribute("data-id"));
      updateSelectionCount();
    });
  });

  // Modal de imagen
  document.getElementById('closeImageModalButton').addEventListener('click', closeImageModal);
  document.querySelectorAll('.avatar-cell').forEach(cell => {
    cell.addEventListener('click', function(e) {
      e.stopPropagation();
      const row = this.closest('tr');
      openImageModal(row ? row.dataset.imagenUrl : null);
    });
  });
}

window.onload = () => {
  if (window.location.search.includes('showModal=true')) {
      openAddModal();
  }
};

// Funciones de la tabla
function handleSearch() {
  const searchTerm = this.value.toLowerCase();
  const rows = document.querySelectorAll('tbody tr');
  
  rows.forEach(row => {
    if (row.querySelector('.no-records')) return;
    
    const nombre = row.querySelector('td:nth-child(4)').textContent.toLowerCase();
    const carnet = row.querySelector('td:nth-child(5)').textContent.toLowerCase();
    
    row.style.display = (nombre.includes(searchTerm) || carnet.includes(searchTerm)) ? '' : 'none';
  });
  
  updateVisibleCount();
}

function toggleSort() {
  sortDirection = sortDirection === 'asc' ? 'desc' : 'asc';
  
  const icon = this.querySelector('.sort-icon') || document.createElement('span');
  icon.className = 'sort-icon';
  icon.textContent = sortDirection === 'asc' ? ' ↑' : ' ↓';
  this.appendChild(icon);
  
  sortTableByName();
}

function sortTableByName() {
  const tbody = document.querySelector('tbody');
  const rows = Array.from(tbody.querySelectorAll('tr:not(.no-records)'));
  
  rows.sort((a, b) => {
    const nameA = a.querySelector('td:nth-child(4)').textContent.toLowerCase();
    const nameB = b.querySelector('td:nth-child(4)').textContent.toLowerCase();
    return sortDirection === 'asc' ? nameA.localeCompare(nameB) : nameB.localeCompare(nameA);
  });
  
  rows.forEach(row => tbody.appendChild(row));
}

// Funciones de selección
function toggleSelectAll() {
  const isChecked = selectAllCheckbox.checked;
  
  document.querySelectorAll('.row-checkbox').forEach(checkbox => {
    checkbox.checked = isChecked;
    const row = checkbox.closest('tr');
    if (row) row.classList.toggle("selected", isChecked);
  });
  
  updateSelectionCount();
}

function toggleRowSelection(rowId) {
  const checkbox = document.querySelector(`.row-checkbox[data-id="${rowId}"]`);
  if (checkbox) {
    const isChecked = checkbox.checked;
    const row = checkbox.closest('tr');
    if (row) row.classList.toggle("selected", isChecked);
  }
}

function updateSelectionCount() {
  const selected = document.querySelectorAll('.row-checkbox:checked').length;
  if (selectedCount) {
    selectedCount.textContent = `${selected} seleccionado(s)`;
  }
}

function updateVisibleCount() {
  const visibleRows = document.querySelectorAll('tbody tr:not([style*="display: none"])').length;
  const totalRows = document.querySelectorAll('tbody tr').length - (document.querySelector('.no-records') ? 1 : 0);
  
  const countElement = document.querySelector('.totalTrabajadores .records-info span:nth-child(2)');
  if (countElement) {
    countElement.textContent = visibleRows === totalRows ? 
      `Total ${totalRows} Trabajador(es)` : 
      `Mostrando ${visibleRows} de ${totalRows} Trabajador(es)`;
  }
}

function checkEmptyState() {
  const hasWorkers = tableRows.length > 1 || 
                    (tableRows.length === 1 && !tableRows[0].querySelector('.no-records'));
  
const isAdmin = tableAddButton.disabled === false;

  [editButton, deleteButton].forEach(button => {
    if (button) {
      button.disabled = !hasWorkers || !isAdmin;
      button.style.opacity = (hasWorkers && isAdmin) ? 1 : 0.5;
      button.style.cursor = (hasWorkers && isAdmin) ? 'pointer' : 'not-allowed';
    }
  });
  
  if (selectAllCheckbox) {
    selectAllCheckbox.style.visibility = hasWorkers ? 'visible' : 'hidden';
  }
}

// Funciones de modales
function openAddModal() {
  document.getElementById('modalTitle').textContent = 'Añadir Trabajador';
  addForm.classList.remove('hidden');
  editForm.classList.add('hidden');
  addPersonModal.classList.remove('hidden');
  
  addForm.reset();
  document.getElementById('facePreviewAdd').src = '';
  document.getElementById('facePreviewAdd').classList.add('hidden');
  document.getElementById('faceUploadAdd').querySelector('.face-plus').classList.remove('hidden');
}

function openEditModal(personaId) {
  document.getElementById('modalTitle').textContent = 'Editar Trabajador';
  addForm.classList.add('hidden');
  editForm.classList.remove('hidden');
  
  editForm.action = `/editar_persona/${personaId}/`;
  
  const row = document.querySelector(`tr[data-id="${personaId}"]`);
  
  document.getElementById('edit_carnet').value = row.querySelector('td:nth-child(5)').textContent;
  document.getElementById('edit_nombre').value = row.querySelector('td:nth-child(4)').textContent;
  document.getElementById('edit_cargo').value = row.querySelector('td:nth-child(6)').textContent;
  document.getElementById('edit_horaE').value = row.querySelector('td:nth-child(7)').textContent;
  document.getElementById('edit_horaS').value = row.querySelector('td:nth-child(8)').textContent;
  
  if (row.dataset.imagenUrl) {
    document.getElementById('facePreviewEdit').src = row.dataset.imagenUrl;
    document.getElementById('facePreviewEdit').classList.remove('hidden');
    document.querySelector('#faceUploadEdit .face-plus').classList.add('hidden');
  }
  
  addPersonModal.classList.remove('hidden');
}

function handleEdit() {
  const selectedRows = document.querySelectorAll('.row-checkbox:checked');
  if (selectedRows.length === 0) {
    alert("Por favor seleccione al menos un trabajador para editar");
    return;
  }
  if (selectedRows.length > 1) {
    alert("Solo puede seleccionar un trabajador a la vez para editar");
    return;
  }
  openEditModal(selectedRows[0].getAttribute('data-id'));
}

function handleDelete() {
  const selectedRows = document.querySelectorAll('.row-checkbox:checked');
  if (selectedRows.length === 0) {
    alert("Por favor seleccione al menos un trabajador para eliminar");
    return;
  }
  
  if (confirm(`¿Está seguro que desea eliminar ${selectedRows.length} trabajador(es)?`)) {
    const deletePromises = Array.from(selectedRows).map(checkbox => {
      const personaId = checkbox.getAttribute('data-id');
      return fetch(`/eliminar_persona/${personaId}/`, {
        method: 'POST',
        headers: {
          'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
        }
      });
    });
    
    Promise.all(deletePromises)
      .then(() => window.location.reload())
      .catch(error => {
        console.error('Error al eliminar:', error);
        alert('Ocurrió un error al eliminar los trabajadores');
      });
  }
}

function closeModal() {
  addPersonModal.classList.add('hidden');
}

// Funciones de imágenes
function handleImageUploadAdd(e) {
  if (e.target.files && e.target.files[0]) {
    const reader = new FileReader();
    reader.onload = function(event) {
      document.getElementById('facePreviewAdd').src = event.target.result;
      document.getElementById('facePreviewAdd').classList.remove('hidden');
      document.getElementById('faceUploadAdd').querySelector('.face-plus').classList.add('hidden');
    };
    reader.readAsDataURL(e.target.files[0]);
  }
}

function handleImageUploadEdit(e) {
  if (e.target.files && e.target.files[0]) {
    const reader = new FileReader();
    reader.onload = function(event) {
      document.getElementById('facePreviewEdit').src = event.target.result;
      document.getElementById('facePreviewEdit').classList.remove('hidden');
      document.querySelector('#faceUploadEdit .face-plus').classList.add('hidden');
    };
    reader.readAsDataURL(e.target.files[0]);
  }
}

function openImageModal(imageUrl) {
  const enlargedImage = document.getElementById('enlargedImage');
  const imagePlaceholder = document.querySelector('.image-placeholder');
  
  if (imageUrl) {
    const img = new Image();
    img.onload = function() {
      enlargedImage.src = imageUrl;
      enlargedImage.style.display = 'block';
      imagePlaceholder.style.display = 'none';
      document.getElementById('imageModal').classList.remove('hidden');
      document.body.style.overflow = 'hidden';
    };
    img.onerror = function() {
      enlargedImage.style.display = 'none';
      imagePlaceholder.style.display = 'flex';
      document.getElementById('imageModal').classList.remove('hidden');
      document.body.style.overflow = 'hidden';
    };
    img.src = imageUrl;
  } else {
    enlargedImage.style.display = 'none';
    imagePlaceholder.style.display = 'flex';
    document.getElementById('imageModal').classList.remove('hidden');
    document.body.style.overflow = 'hidden';
  }
}

function closeImageModal() {
  document.getElementById('imageModal').classList.add('hidden');
  document.body.style.overflow = '';
}
  </script>
   <script>
    document.addEventListener("DOMContentLoaded", function () {
  // Elementos del DOM
  const menuToggle = document.querySelector(".menu-toggle");
  const sidebar = document.querySelector(".sidebar");
  const menuItems = document.querySelectorAll(".menu-item");

  // Función para cerrar todos los menús
  function closeAllMenus() {
    sidebar.classList.remove("active");
  }

  // Toggle del menú sidebar
  menuToggle.addEventListener("click", function (e) {
    e.stopPropagation();
    sidebar.classList.toggle("active");
  });

  // Cerrar menú al seleccionar una opción del sidebar
  menuItems.forEach((item) => {
    item.addEventListener("click", function () {
      if (window.innerWidth <= 1024) {
        sidebar.classList.remove("active");
      }
    });
  });

  // Cerrar menús al hacer clic fuera
  document.addEventListener("click", function (e) {
    // Solo cerrar si no se hizo clic en ningún elemento de control
    if (
      !e.target.closest(
        ".menu-toggle, .sidebar, .user-dropdown, .user-dropdown-menu"
      )
    ) {
      closeAllMenus();
    }
  });

  // Ajustar el sidebar al cambiar tamaño de pantalla
  window.addEventListener("resize", function () {
    if (window.innerWidth > 1024) {
      sidebar.classList.remove("active");
    }
  });
});
// Agrega esto en tu función setupEventListeners()

// Validación para nombre y cargo (solo letras y espacios)
document.querySelectorAll('#add_nombre, #edit_nombre, #add_cargo, #edit_cargo').forEach(input => {
  input.addEventListener('input', function() {
    // Elimina cualquier carácter que no sea letra, espacio o acento
    this.value = this.value.replace(/[^A-Za-zÁÉÍÓÚáéíóúñÑ ]/g, '');
  });
  
  // Validación al enviar el formulario
  input.addEventListener('blur', function() {
    const errorId = this.id.startsWith('add_') ? 
      `${this.id}_error` : 
      `${this.id.replace('edit_', 'add_')}_error`;
    
    const errorElement = document.getElementById(errorId);
    
    if (!/^[A-Za-zÁÉÍÓÚáéíóúñÑ ]+$/.test(this.value) {
      if (errorElement) {
        errorElement.textContent = 'Solo se permiten letras y espacios';
        errorElement.style.display = 'block';
      }
    } else {
      if (errorElement) {
        errorElement.style.display = 'none';
      }
    }
  });
});
   </script>
  
  </body>
</html>