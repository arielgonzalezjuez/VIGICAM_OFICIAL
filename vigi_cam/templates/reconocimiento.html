{% load static %}
<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vigi Cam</title>
    <link rel="shortcut icon" href="{% static "images/favicon.ico" %}" type="image/x-icon">
    <style>
      /* Reset and base styles */
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
      }

      body {
        color: #e0e0e0;
        overflow: hidden;
        height: 100vh;
        display: flex;
        flex-direction: column;
      }

      button {
        background: transparent;
        border: none;
        color: #e0e0e0;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      button:hover {
        background-color: rgba(255, 255, 255, 0.1);
      }

      /* Layout */
      .container {
        display: flex;
        flex-direction: column;
        height: 100vh;
        background-color: #2a2a2a;
      }

      /* Header */
      .header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0 1rem;
        background-color: #1e2124;
        border-bottom: 1px solid #3a3e45;
        height: 60px;
        flex-shrink: 0;
        position: relative;
        z-index: 101; 
      }
      
      .logo-container {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        flex-grow: 1;
        cursor: pointer;
      
      }
      
      .logo-image {
        height: 50px; /* Ajusta según tu logo */
        margin: 0 0 0 10px;
        transition: transform 0.3s ease;
        object-fit: contain;
      }
      
      .logo-container:hover .logo-image {
        transform: scale(1.05);
      }
      
      .app-name {
        font-weight: 600;
        font-size: 1.1rem;
      }
      
      .current-user {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        padding: 0.5rem 1rem;
        border-radius: 6px;
        background-color: #2b2e33;
        font-size: 0.9rem;
      }
      
      .current-user-avatar {
        width: 32px;
        height: 32px;
        border-radius: 50%;
        background-color: #e53935;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: bold;
        font-size: 0.9rem;
      }

      .window-controls {
        display: flex;
        align-items: center;
        gap: 8px;
        margin-left: 16px;
      }

      .icon-button {
        width: 32px;
        height: 32px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 4px;
      }

      /* Main content */
      .main-content {
        display: flex;
        flex: 1;
        overflow: hidden;
      }

      /* Sidebar */
      .sidebar-panel {
        width: 275px;
        background-color: #2a2a2a;
        border-right: 1px solid #444;
        display: flex;
        flex-direction: column;
      }

      .tab-header {
        padding: 8px;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .main-tab {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 8px 12px;
        background-color: #1e1e1e;
        border-bottom: 2px solid #d32f2f;
        border-radius: 2px;
      }

      .tab-buttons {
        display: flex;
        gap: 8px;
        padding: 8px;
      }

      .tab-button {
        padding: 6px 16px;
        border-radius: 9999px;
        font-size: 14px;
      }

      .tab-button.active {
        background-color: #1e1e1e;
      }

      .search-container {
        position: relative;
        padding: 8px;
      }

      .search-input {
        width: 100%;
        padding: 8px 32px 8px 8px;
        background-color: #1e1e1e;
        border: 1px solid #444;
        border-radius: 4px;
        color: #e0e0e0;
      }

      .search-icon {
        position: absolute;
        right: 16px;
        top: 50%;
        transform: translateY(-50%);
        color: #888;
      }

      .sidebar-content {
        flex: 1;
        overflow: auto;
      }

      .user-item {
        margin: 8px;
        padding: 8px;
        display: flex;
        align-items: center;
        gap: 8px;
        cursor: pointer;
        border-left: 2px solid transparent;
        position: relative;
      }

      .user-item.selected {
        background-color: #1e1e1e;
        border-left: 2px solid #d32f2f;
      }

      .play-icon {
        position: absolute;
        right: 8px;
        width: 20px;
        height: 20px;
        color: #d32f2f;
        border-radius: 50%;
        padding: 4px;
        transition: all 0.2s ease;
        cursor: pointer;
        z-index: 2;
      }

      .play-icon:hover {
        background-color: rgba(255, 255, 255, 0.1);
        box-shadow: 0 0 0 2px rgba(211, 47, 47, 0.5);
      }

      .play-icon:active {
        transform: scale(0.95);
      }

      .play-icon.selected {
        color: white;
        background-color: #d32f2f;
      }

      .stop-icon {
        position: absolute;
        right: 8px;
        width: 20px;
        height: 20px;
        color: #d32f2f;
        border-radius: 50%;
        padding: 4px;
        transition: all 0.2s ease;
        cursor: pointer;
        z-index: 2;
        display: none;
      }

      .stop-icon:hover {
        background-color: rgba(255, 255, 255, 0.1);
        box-shadow: 0 0 0 2px rgba(211, 47, 47, 0.5);
      }

      .stop-icon:active {
        transform: scale(0.95);
      }

      .play-icon.playing {
        display: none;
      }

      .stop-icon.stopping {
        display: block;
      }

      .video-placeholder {
        width: 100%;
        height: 100%;
        background-color: #444;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #777;
        font-size: 14px;
      }

      .video-container {
        width: 100%;
        height: 100%;
        display: none;
        background-color: #000;
      }

      .video-container.active {
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .camera-name-overlay {
        position: absolute;
        top: 10px;
        left: 10px;
        background: rgba(0, 0, 0, 0.7);
        color: #fff;
        padding: 6px 12px;
        border-radius: 4px;
        font-size: 0.9rem;
        z-index: 2;
        pointer-events: none;
        display: none; /* Oculto por defecto */
    }
    
    .video-container.active .camera-name-overlay {
        display: block; /* Mostrar cuando hay video activo */
    }
      #camera-stream {
        max-width: 100%;
        max-height: 100%;
        object-fit: contain;
      }

      /* Video grid */
      .video-grid {
        flex: 2;
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
    gap: 1px;
    background-color: #1e1e1e;
    padding: 1px;
    overflow: auto;
      }

      .video-cell {
        position: relative;
    background-color: #444;
    min-height: 300px;
      }

      /* Control bar */
      .control-bar {
        background-color: #1e1e1e;
        border-top: 1px solid #444;
      }

      .ptz-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 8px 16px;
      }

      .ptz-title {
        display: flex;
        align-items: center;
        gap: 8px;
        font-weight: 500;
      }

      .ptz-controls {
        display: flex;
        align-items: center;
        gap: 16px;
      }

      .control-actions {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 8px 16px;
        border-top: 1px solid #444;
      }

      .action-group {
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .circle-button {
        width: 32px;
        height: 32px;
        border-radius: 50%;
        background-color: #2a2a2a;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      /* System tray */
      .system-tray {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 4px 16px;
        background-color: #1e1e1e;
        border-top: 1px solid #444;
      }

      .tray-left {
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .tray-icons {
        display: flex;
        align-items: center;
        gap: 4px;
        margin-left: 8px;
      }

      .tray-icon {
        width: 24px;
        height: 24px;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .tray-icon-placeholder {
        width: 16px;
        height: 16px;
        background-color: #666;
        border-radius: 2px;
      }

      .tray-right {
        display: flex;
        align-items: center;
        gap: 8px;
      }

      /* Footer */
      .footer {
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 0.75rem;
        background-color: #1e2124;
        border-top: 1px solid #3a3e45;
        height: 50px;
        flex-shrink: 0;
      }
      
      .logout-icon {
        width: 1.5rem;
        height: 1.5rem;
        cursor: pointer;
        transition: transform 0.2s;
      }
      
      .logout-icon:hover {
        transform: scale(1.1);
      }

      .modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.7);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 1000;
      }

      .modal-content {
        background: #2a2a2a;
        padding: 20px;
        border-radius: 8px;
        width: 400px;
        max-width: 90%;
        border: 1px solid #444;
      }

      .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        border-bottom: 1px solid #444;
        padding-bottom: 10px;
      }

      .close-modal {
        background: none;
        border: none;
        color: #e0e0e0;
        font-size: 24px;
        cursor: pointer;
      }

      .form-group {
        margin-bottom: 15px;
      }

      .form-group label {
        display: block;
        margin-bottom: 5px;
        color: #e0e0e0;
      }

      .form-group input {
        width: 100%;
        padding: 8px;
        background: #1e1e1e;
        border: 1px solid #444;
        border-radius: 4px;
        color: #e0e0e0;
      }

      .submit-btn {
        background: #d32f2f;
        color: white;
        border: none;
        padding: 10px 15px;
        border-radius: 4px;
        cursor: pointer;
        width: 100%;
        margin-top: 10px;
      }

      .submit-btn:hover {
        background: #b71c1c;
      }

      input:invalid {
        border-color: #d32f2f;
      }

      .loader-container {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.7);
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 10;
      }

      .dot-spinner {
  --uib-size: 2.8rem;
  --uib-speed: 0.9s;
  --uib-color: #d32f2f;
  position: relative;
  display: flex;
  align-items: center;
  justify-content: flex-start;
  height: var(--uib-size);
  width: var(--uib-size);
}

.dot-spinner__dot {
  position: absolute;
  top: 0;
  left: 0;
  display: flex;
  align-items: center;
  justify-content: flex-start;
  height: 100%;
  width: 100%;
}

.dot-spinner__dot::before {
  content: "";
  height: 20%;
  width: 20%;
  border-radius: 50%;
  background-color: var(--uib-color);
  transform: scale(0);
  opacity: 0.5;
  animation: pulse0112 calc(var(--uib-speed) * 1.111) ease-in-out infinite;
  box-shadow: 0 0 20px rgba(18, 31, 53, 0.3);
}

.dot-spinner__dot:nth-child(2) {
  transform: rotate(45deg);
}

.dot-spinner__dot:nth-child(2)::before {
  animation-delay: calc(var(--uib-speed) * -0.875);
}

.dot-spinner__dot:nth-child(3) {
  transform: rotate(90deg);
}

.dot-spinner__dot:nth-child(3)::before {
  animation-delay: calc(var(--uib-speed) * -0.75);
}

.dot-spinner__dot:nth-child(4) {
  transform: rotate(135deg);
}

.dot-spinner__dot:nth-child(4)::before {
  animation-delay: calc(var(--uib-speed) * -0.625);
}

.dot-spinner__dot:nth-child(5) {
  transform: rotate(180deg);
}

.dot-spinner__dot:nth-child(5)::before {
  animation-delay: calc(var(--uib-speed) * -0.5);
}

.dot-spinner__dot:nth-child(6) {
  transform: rotate(225deg);
}

.dot-spinner__dot:nth-child(6)::before {
  animation-delay: calc(var(--uib-speed) * -0.375);
}

.dot-spinner__dot:nth-child(7) {
  transform: rotate(270deg);
}

.dot-spinner__dot:nth-child(7)::before {
  animation-delay: calc(var(--uib-speed) * -0.25);
}

.dot-spinner__dot:nth-child(8) {
  transform: rotate(315deg);
}

.dot-spinner__dot:nth-child(8)::before {
  animation-delay: calc(var(--uib-speed) * -0.125);
}

@keyframes pulse0112 {
  0%,
  100% {
    transform: scale(0);
    opacity: 0.5;
  }

  50% {
    transform: scale(1);
    opacity: 1;
  }
}


      .video-container {
        position: relative;
      }

      /* Estilos para elementos deshabilitados */
      button:disabled, input:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }

      .error-message {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    background-color: rgba(0, 0, 0, 0.8);
    color: #fff;
    text-align: center;
    padding: 20px;
}

.error-message svg {
    margin-bottom: 16px;
}

.error-message h3 {
    color: #d32f2f;
    margin-bottom: 8px;
}

.error-message p {
    margin-bottom: 16px;
    color: #ccc;
}

.error-message button {
    background-color: #d32f2f;
    color: white;
    border: none;
    padding: 8px 16px;
    border-radius: 4px;
    cursor: pointer;
    margin-top: 8px;
}

.error-message button:hover {
    background-color: #b71c1c;
}

/* Elimina o comenta estas clases antiguas */
/*
.logo {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 1.75rem;
  height: 1.75rem;
  background-color: #e53935;
  border-radius: 50%;
}

.logo-inner {
  width: 0.875rem;
  height: 0.875rem;
  background-color: #1e2124;
  border-radius: 50%;
}
*/

/* Agrega nuevos estilos para el logo */
.logo-image {
  height: 40px; /* Ajusta según tu logo */
  margin: 0 12px;
  transition: transform 0.3s ease;
  object-fit: contain;
}

.logo-container:hover .logo-image {
  transform: scale(1.05);
}

.app-name {
  font-size: 1.1rem;
  font-weight: 600;
  color: #fff;
  text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
}

/* Ajustes responsive */
@media (max-width: 768px) {
  .logo-image {
    height: 30px;
    margin: 0 8px;
  }
  .app-name {
    font-size: 1rem;
  }
}

@media (max-width: 480px) {
  .logo-image {
    height: 25px;
  }
  .app-name {
    font-size: 0.9rem;
  }
}

/* Contenedores de controles */
.play-control, .stop-control {
  position: absolute;
  right: 8px;
  display: flex;
  align-items: center;
}

/* Tooltip izquierdo */
.left-tooltip {
  position: absolute;
  right: calc(100% + 40px);
  opacity: 0;
  background-color: #1e1e1e;
  color: white;
  padding: 6px 12px;
  border-radius: 5px;
  font-size: 0.85rem;
  white-space: nowrap;
  pointer-events: none;
  transition: all 0.3s ease;
  transform: translateX(20px);
  box-shadow: 2px 2px 8px rgba(0, 0, 0, 0.3);
  z-index: 1000; /* Nivel superior */
}

.left-tooltip::before {
  content: "";
  position: absolute;
  left: 100%;
  top: 50%;
  transform: translateY(-50%);
  border-width: 6px;
  border-style: solid;
  border-color: transparent transparent transparent #1e1e1e;
}

/* Animación de aparición */
.play-control:hover .left-tooltip,
.stop-control:hover .left-tooltip {
  opacity: 1;
  transform: translateX(0);
}

/* Ajuste posición vertical */
.play-control, .stop-control {
  top: 50%;
  transform: translateY(-50%);
}

.menu-icon {
  width: 1.5rem;
  height: 1.5rem;
  stroke-width: 2;
}

/* Sidebar styles */
.menu-content {
  display: flex;
  flex-direction: column;
  gap: 0.5rem; /* Menor espacio entre items */
  flex: 1;
  overflow-y: auto;
  padding: 1rem 0.5rem; /* Padding más compacto */
}

.menu-item {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  font-size: 0.9rem;
  padding: 0.75rem 1.25rem;
  cursor: pointer;
  white-space: nowrap;
  transition: all 0.2s ease;
  border-radius: 6px;
  margin: 0 0.5rem; /* Margen interno */
  color: #d1d5db; /* Color texto más claro */
}

.menu-item:hover {
  background-color: #34373d;
  transform: translateX(3px); /* Efecto de desplazamiento */
}

.menu-item.active {
  background-color: #3a3e45;
  border-left: 3px solid #e53935;
  font-weight: 500;
  color: white;
}

.menu-item .icon {
  width: 1.1rem;
  height: 1.1rem;
  stroke-width: 2;
  transition: color 0.2s;
}

.menu-item.active .icon {
  color: white;
}

/* Scrollbar personalizada */
.menu-content::-webkit-scrollbar {
  width: 6px;
}

.menu-content::-webkit-scrollbar-track {
  background: #25282d;
}

.menu-content::-webkit-scrollbar-thumb {
  background-color: #3a3e45;
  border-radius: 3px;
}

/* Estilos del sidebar */
.sidebar-menu {
  position: fixed;
  top: 60px;
  left: 0;
  width: 275px;
  height: calc(100vh - 110px);
  background-color: #2a2a2a;
  transform: translateX(-100%);
  transition: transform 0.3s ease-out;
  z-index: 1000;
  overflow-y: auto;
}

.sidebar-menu.active {
  transform: translateX(0);
  box-shadow: 2px 0 10px rgba(0, 0, 0, 0.2);
}

/* Overlay de fondo */
.sidebar-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.5);
  z-index: 999;
  opacity: 0;
  visibility: hidden;
  transition: opacity 0.3s ease, visibility 0.3s ease;
}

.sidebar-overlay.active {
  opacity: 1;
  visibility: visible;
}

/* Transición para los items del menú */
.menu-item {
  opacity: 0;
  transform: translateX(-20px);
  transition: all 0.3s ease;
}

.sidebar-menu.active .menu-item {
  opacity: 1;
  transform: translateX(0);
}

/* Retrasos escalonados para los items */
.sidebar-menu.active .menu-item:nth-child(1) { transition-delay: 0.1s; }
.sidebar-menu.active .menu-item:nth-child(2) { transition-delay: 0.15s; }
.sidebar-menu.active .menu-item:nth-child(3) { transition-delay: 0.2s; }
.sidebar-menu.active .menu-item:nth-child(4) { transition-delay: 0.25s; }
.sidebar-menu.active .menu-item:nth-child(5) { transition-delay: 0.3s; }
.sidebar-menu.active .menu-item:nth-child(6) { transition-delay: 0.35s; }

/* Icono del menú hamburguesa */
#menu-toggle {
  transition: transform 0.3s ease;
}

.sidebar-menu.active ~ .header #menu-toggle {
  transform: rotate(90deg);
}

    </style>
  </head>
  <body>
    <div class="container">
      <!-- Header -->
      <header class="header">
        <div class="logo-container" onclick="window.location.href='/'">
         
          <!-- Nuevo logo con imagen -->
          <img src="{% static 'images/logo.png' %}" class="logo-image" alt="Logo Vigi Cam">
          <span class="app-name">Vigi Cam</span>
        </div>
        
        <div class="header-controls">
          <div class="current-user">
            <div class="current-user-avatar">{{ user.username.0|upper }}</div>
            <span>{{ user.username }}</span>
          </div>
        </div>
      </header>

      <!-- Main content -->
      <div class="main-content">
        <!-- Sidebar -->
           <div class="sidebar-menu hidden">
          <div class="menu-content">
            <div class="menu-item" onclick="window.location.href='/'">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
                class="icon"
                width="16"
                height="16"
              >
                <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                <polyline points="9 22 9 12 15 12 15 22"></polyline>
              </svg>
              <span>Página Principal</span>
            </div>
  
            <div class="menu-item active" onclick="window.location.href='{% url "cameras" %}'">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
                class="icon"
                width="16"
                height="16"
              >
                <path
                  d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"
                ></path>
                <circle cx="12" cy="13" r="4"></circle>
              </svg>
              <span>Cámaras</span>
            </div>
  
            <div class="menu-item" onclick="window.location.href='{% url "trabajadores" %}'">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
                class="icon"
                width="16"
                height="16"
              >
                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                <circle cx="9" cy="7" r="4"></circle>
                <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
              </svg>
              <span>Trabajadores</span>
            </div>
  
            <div class="menu-item" onclick="window.location.href='{% url "administrador" %}'">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
                class="icon"
                width="16"
                height="16"
              >
                <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                <circle cx="8.5" cy="7" r="4"></circle>
                <line x1="20" y1="8" x2="20" y2="14"></line>
                <line x1="23" y1="11" x2="17" y2="11"></line>
              </svg>
              <span>Administrador</span>
            </div>
            <div class="menu-item" onclick="window.location.href='{% url "registro" %}'">
              <svg
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
              class="icon"
              width="16"
              height="16"
            >
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
              <path d="M14 2v6h6"></path>
              <path d="M8 13v4"></path>
              <path d="M12 13v2"></path>
              <path d="M16 13v6"></path>
            </svg>
              <span>Registros</span>
            </div>
            <div class="menu-item" onclick="window.location.href='{% url "videos" %}'">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
                class="icon"
                width="16"
                height="16"
              >
                <polygon points="23 7 16 12 23 17 23 7"></polygon>
                <rect x="1" y="5" width="15" height="14" rx="2" ry="2"></rect>
              </svg>
              <span>Videos</span>
            </div>
          </div>
        </div>
        <div class="sidebar-panel">
          <div class="tab-header">
            <button class="icon-button" id="menu-toggle">
              <svg
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <line x1="3" y1="12" x2="21" y2="12"></line>
                <line x1="3" y1="6" x2="21" y2="6"></line>
                <line x1="3" y1="18" x2="21" y2="18"></line>
              </svg>
            </button>
            <div class="main-tab">
              <svg
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                <line x1="3" y1="9" x2="21" y2="9"></line>
                <line x1="9" y1="21" x2="9" y2="9"></line>
              </svg>
              <span>Cámaras</span>
            </div>
            <div class="icon-button" style="margin-left: auto; cursor: pointer;" onclick="window.location.href='{% url "index" %}'">
              <svg
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
              </svg>
            </div>
          </div>

          <div class="search-container">
            <input type="text" class="search-input" placeholder="Buscar" />
            <div class="search-icon">
              <svg
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <circle cx="11" cy="11" r="8"></circle>
                <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
              </svg>
            </div>
          </div>

          <div class="sidebar-content">
            {% for camara in camaras %}
            <div
              class="user-item {% if forloop.first %}selected{% endif %}"
              data-camera-id="{{ camara.id }}"
              data-nombre="{{ camara.nombreC }}"
              data-numero_ip="{{ camara.numero_ip }}" 
              data-puerto="{{ camara.puerto }}"
              data-usuario="{{ camara.usuario }}"
              data-password="{{ camara.password }}">  
            
              <svg
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                <line x1="3" y1="9" x2="21" y2="9"></line>
                <line x1="9" y1="21" x2="9" y2="9"></line>
              </svg>
              <span>{{ camara.nombreC }}</span>

              <div class="play-control">
                <svg
                class="play-icon"
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <polygon points="5 3 19 12 5 21 5 3"></polygon>
              </svg>
                <span class="tooltip left-tooltip">Reproducir</span>
              </div>
              
              <div class="stop-control">
                <svg
                class="stop-icon"
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <rect x="6" y="6" width="12" height="12"></rect>
              </svg>
                <span class="tooltip left-tooltip">Detener</span>
              </div>
            </div>
            {% endfor %}
          </div>
          
          <!-- Control bar -->
          <div class="control-bar">
            <div class="control-actions">
              <div class="action-group">
                <button class="circle-button" id="add-camera-btn" >
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="12" y1="5" x2="12" y2="19"></line>
                    <line x1="5" y1="12" x2="19" y2="12"></line>
                  </svg>
                </button>
                <button class="icon-button" id="edit-camera-btn">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                    <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                  </svg>
                </button>
                <button class="icon-button" id="delete-camera-btn">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <polyline points="3 6 5 6 21 6"></polyline>
                    <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                    <line x1="10" y1="11" x2="10" y2="17"></line>
                    <line x1="14" y1="11" x2="14" y2="17"></line>
                  </svg>
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Video grid -->
        <!-- Video grid -->
<div class="video-grid" id="video-grid">
  <div class="video-placeholder" id="default-placeholder">
      Selecciona una cámara y haz clic en play
  </div>
</div>
        
      </div>

      <!-- Footer -->
      <footer class="footer">
        <svg onclick="window.location.href='{% url "cerrarSession" %}'"
        xmlns="http://www.w3.org/2000/svg"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
        class="logout-icon"
        width="20"
        height="20"
      >
        <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
        <polyline points="16 17 21 12 16 7"></polyline>
        <line x1="21" y1="12" x2="9" y2="12"></line>
      </svg>
      </footer>
    </div>

    <!-- Modal (solo diseño visual) -->
    <div id="addCameraModal" class="modal" style="display: none">
      <div class="modal-content">
          <div class="modal-header">
              <h3 id="modal-title">Añadir Nueva Cámara</h3>
              <button class="close-modal" onclick="closeCameraModal()">&times;</button>
          </div>
          <form id="cameraForm" method="post" action="">
              {% csrf_token %}
             {{ form.as_p }} 
              <div class="form-group">
                <label for="id_nombreC">Nombre/Ubicación:</label>
                <input type="text" id="id_nombreC" name="nombreC" required  pattern="[A-Za-zÁÉÍÓÚáéíóúñÑ\s]+"
    minlength="2"
    maxlength="50"
    title="Mínimo 2 letras, máximo 50. Solo se permiten letras y espacios.">
            </div>
            <div class="form-group">
                <label for="id_numero_ip">Dirección IP:</label>
                <input type="text" id="id_numero_ip" name="numero_ip" required>
            </div>
            <div class="form-group">
                <label for="id_puerto">Puerto:</label>
                <input type="number" id="id_puerto" name="puerto" required>
            </div>
            <div class="form-group">
                <label for="id_usuario">Usuario:</label>
                <input type="text" id="id_usuario" name="usuario" required>
            </div>
            <div class="form-group">
                <label for="id_password">Contraseña:</label>
                <input type="password" id="id_password" name="password" required>
            </div>
              <button type="submit" class="submit-btn" disabled>Guardar Cámara</button>
          </form>
      </div>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const videoGrid = document.getElementById("video-grid");
        const defaultPlaceholder = document.getElementById("default-placeholder");
        const cameraItems = document.querySelectorAll(".user-item");
        let activeStreams = {};
        const MAX_STREAMS = 6;
    
        function updatePlaceholder() {
            defaultPlaceholder.style.display = 
                Object.keys(activeStreams).length === 0 ? "flex" : "none";
        }
    
        cameraItems.forEach(item => {
            const cameraId = item.dataset.cameraId;
            const playControl = item.querySelector(".play-control");
            const stopControl = item.querySelector(".stop-control");
    
            item.addEventListener("click", function(e) {
                if (!e.target.closest(".play-control, .stop-control")) {
                    cameraItems.forEach(cam => cam.classList.remove("selected"));
                    this.classList.add("selected");
                }
            });
    
            playControl.addEventListener("click", function(e) {
                e.stopPropagation();
                
                if (Object.keys(activeStreams).length >= MAX_STREAMS) {
                    alert(`Máximo ${MAX_STREAMS} transmisiones simultáneas`);
                    return;
                }
                
                if (!activeStreams[cameraId]) {
                    startStream(item);
                    updatePlaceholder();
                }
            });
    
            stopControl.addEventListener("click", function(e) {
                e.stopPropagation();
                
                if (activeStreams[cameraId]) {
                    stopStream(cameraId);
                    updatePlaceholder();
                }
            });
        });
    
        function startStream(item) {
          const cameraId = item.dataset.cameraId;
          const nombre = item.dataset.nombre;
      
          // Crear elemento de video
          const videoCell = document.createElement("div");
          videoCell.className = "video-cell";
          videoCell.innerHTML = `
              <div class="video-container active">
                  <div class="camera-name-overlay">${nombre}</div>
                  <div class="loader-container">
                      <div class="dot-spinner">
                            <div class="dot-spinner__dot"></div>
      <div class="dot-spinner__dot"></div>
      <div class="dot-spinner__dot"></div>
      <div class="dot-spinner__dot"></div>
      <div class="dot-spinner__dot"></div>
      <div class="dot-spinner__dot"></div>
      <div class="dot-spinner__dot"></div>
      <div class="dot-spinner__dot"></div>
                      </div>
                  </div>
                  <img class="camera-stream" alt="" />
              </div>
          `;
      
          videoGrid.appendChild(videoCell);
          
          const streamImg = videoCell.querySelector(".camera-stream");
          const loader = videoCell.querySelector(".loader-container");
      
          // Cargar stream
          streamImg.src = `/capturavideo/${cameraId}`;
      
          activeStreams[cameraId] = {
              element: videoCell,
              imgElement: streamImg
          };
      
          streamImg.onload = () => {
              loader.style.display = "none";
              videoCell.querySelector(".error-message")?.remove();
          };
      
          streamImg.onerror = () => {
              loader.style.display = "none";
              handleStreamError(cameraId, videoCell);
          };
      
          updateListControls(cameraId, true);
      }
    
        function stopStream(cameraId) {
            if (!activeStreams[cameraId]) return;
            
            // Detener el stream
            const streamImg = activeStreams[cameraId].imgElement;
            streamImg.src = ""; // Liberar recurso
            streamImg.remove();
    
            activeStreams[cameraId].element.remove();
            delete activeStreams[cameraId];
            
            updateListControls(cameraId, false);
        }
    
        function updateListControls(cameraId, isPlaying) {
            const listItem = document.querySelector(`[data-camera-id="${cameraId}"]`);
            if (listItem) {
                const playIcon = listItem.querySelector(".play-icon");
                const stopIcon = listItem.querySelector(".stop-icon");
                
                playIcon.style.display = isPlaying ? "none" : "block";
                stopIcon.style.display = isPlaying ? "block" : "none";
            }
        }
    
        function handleStreamError(cameraId, videoCell) {
          if (!videoCell.querySelector(".error-message")) {
              const errorDiv = document.createElement("div");
              errorDiv.className = "error-message";
              errorDiv.innerHTML = `
                  <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="#d32f2f">
                      <circle cx="12" cy="12" r="10"/>
                      <line x1="12" y1="8" x2="12" y2="12"/>
                      <line x1="12" y1="16" x2="12.01" y2="16"/>
                  </svg>
                  <h3>Error de conexión</h3>
                  <button onclick="retryStream('${cameraId}')">Reintentar</button>
              `;
              videoCell.querySelector(".video-container").appendChild(errorDiv);
          }
      }
    
        window.retryStream = function(cameraId) {
            if (activeStreams[cameraId]) {
                const streamImg = activeStreams[cameraId].imgElement;
                streamImg.src = `/capturavideo/${cameraId}`;
            }
        };
    
        updatePlaceholder();
    });
    </script>
    <script>
      // Función para leer la cookie CSRF (de Django docs)
      function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
          document.cookie.split(';').forEach(c => {
            const cookie = c.trim();
            if (cookie.startsWith(name + '=')) {
              cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
            }
          });
        }
        return cookieValue;
      }
      const csrftoken = getCookie('csrftoken');
      
      document.addEventListener("DOMContentLoaded", () => {
        const addBtn    = document.getElementById('add-camera-btn');
        const editBtn   = document.getElementById('edit-camera-btn');
        const deleteBtn = document.getElementById('delete-camera-btn');
        const searchIn  = document.querySelector('.search-input');
        const modal     = document.getElementById('addCameraModal');
        const closeBtn  = modal.querySelector('.close-modal');
        const form      = document.getElementById('cameraForm');
        let selectedItem = document.querySelector('.user-item.selected');
        let mode = null; // 'add' o 'edit'
        window.onload = () => {
          const urlParams = new URLSearchParams(window.location.search);
          if (urlParams.has('showModal')) {
              openModal('add'); // Cambiar openCameraModal() por openModal('add')
          }
        };
        function openModal(m) {
          mode = m;
          const title = modal.querySelector('#modal-title');
          form.querySelectorAll('input, button[type="submit"]').forEach(el => el.disabled = false);
      
          if (mode === 'add') {
            title.textContent = 'Añadir Nueva Cámara';
            form.action = "{% url 'registrar_camara' %}";
            form.reset();
          } else {
            title.textContent = 'Editar Cámara';
            const id = selectedItem.dataset.cameraId;
            form.action = `/reconocimiento/edit/${id}/`;
            // Asegúrate de que estos nombres coincidan con los data-* del HTML
            form.nombreC.value = selectedItem.dataset.nombre;
            form.numero_ip.value = selectedItem.dataset.numero_ip;
            form.puerto.value = selectedItem.dataset.puerto;
            form.usuario.value = selectedItem.dataset.usuario;
            form.password.value = selectedItem.dataset.password;
          }
          modal.style.display = 'flex';
          if (window.history.replaceState && mode === 'add') {
            const newUrl = window.location.href.split('?')[0];
            window.history.replaceState({}, document.title, newUrl);
        }
        }
      
        closeBtn.addEventListener('click', () => modal.style.display = 'none');
        addBtn.addEventListener('click', () => openModal('add'));
        editBtn.addEventListener('click', () => openModal('edit'));
      
        // selección de cámara
        document.querySelectorAll('.user-item').forEach(item => {
          item.addEventListener('click', () => {
            document.querySelectorAll('.user-item').forEach(i => i.classList.remove('selected'));
            item.classList.add('selected');
            selectedItem = item;
            editBtn.disabled = deleteBtn.disabled = false;
          });
        });
      
        // ENVÍO AJAX de add/edit - MODIFICADO PARA MANEJAR REDIRECCIONES
        form.addEventListener('submit', e => {
          e.preventDefault();
          const formData = new FormData(form);
          
          fetch(form.action, {
            method: 'POST',
            headers: { 'X-CSRFToken': csrftoken },
            body: formData
          })
          .then(response => {
            if (response.redirected) {
              // Si hay redirección (éxito), recarga la página
              window.location.href = response.url;
              return;
            }
            return response.json().then(data => {
              if (data && data.status === 'error') {
                throw new Error(JSON.stringify(data.errors));
              }
            });
          })
          .catch(error => {
            console.error('Error:', error);
            alert('Error al guardar: ' + error.message);
          });
        });
      // En el evento DOMContentLoaded de cameras.html

        // Eliminar - MODIFICADO PARA RECARGAR DESPUÉS DE ELIMINAR
        deleteBtn.addEventListener('click', () => {
          const nombreCam = selectedItem.dataset.nombre;
          if (!selectedItem || !confirm(`¿Eliminar ${nombreCam}?`)) return;
          const id = selectedItem.dataset.cameraId;
          fetch(`/reconocimiento/delete/${id}/`, {
            method: 'POST',
            headers: {
              'X-CSRFToken': csrftoken,
              'X-Requested-With': 'XMLHttpRequest'
            },
          })
          .then(response => {
            if (response.redirected) {
              window.location.href = response.url;
            } else {
              return response.json();
            }
          })
          .then(data => {
            if (data && data.status === 'success') {
              location.reload(); // Recarga si no hubo redirección
            } else if (data) {
              alert('Error: ' + data.error);
            }
          })
          .catch(error => console.error('Error:', error));
        });
      
        // Búsqueda en tiempo real
        searchIn.addEventListener('input', e => {
          const term = e.target.value.toLowerCase();
          document.querySelectorAll('.user-item').forEach(item => {
            item.style.display = item.dataset.nombre.toLowerCase().includes(term) ? '' : 'none';
          });
        });
      });
    </script>
      <script>
document.addEventListener("DOMContentLoaded", function() {
  // Elementos del DOM
  const sidebarMenu = document.querySelector('.sidebar-menu');
  const menuToggle = document.getElementById('menu-toggle');
  const sidebarOverlay = document.createElement('div');
  sidebarOverlay.className = 'sidebar-overlay';
  document.body.appendChild(sidebarOverlay);

  // Estado del menú
  let isMenuOpen = false;

  // Función para abrir el menú
  function openMenu() {
    sidebarMenu.classList.add('active');
    sidebarOverlay.classList.add('active');
    document.body.style.overflow = 'hidden';
    isMenuOpen = true;
  }

  // Función para cerrar el menú
  function closeMenu() {
    sidebarMenu.classList.remove('active');
    sidebarOverlay.classList.remove('active');
    document.body.style.overflow = '';
    isMenuOpen = false;
  }

  // Toggle del menú
  function toggleMenu() {
    if (isMenuOpen) {
      closeMenu();
    } else {
      openMenu();
    }
  }

  // Event Listeners
  menuToggle.addEventListener('click', function(e) {
    e.stopPropagation();
    toggleMenu();
  });

  sidebarOverlay.addEventListener('click', closeMenu);

  // Cerrar al hacer clic fuera del menú
  document.addEventListener('click', function(e) {
    if (isMenuOpen && !sidebarMenu.contains(e.target) && e.target !== menuToggle) {
      closeMenu();
    }
  });

  // Manejar el resize de la ventana
  window.addEventListener('resize', function() {
    if (window.innerWidth > 768) {
      sidebarMenu.classList.remove('active');
      sidebarOverlay.classList.remove('active');
      document.body.style.overflow = '';
      isMenuOpen = false;
    }
  });
});
</script>

  </body>
</html>