En este sistema se implementó un módulo especializado para el entrenamiento y la predicción de rostros humanos basado en técnicas de reconocimiento facial, con un enfoque orientado a mejorar la precisión en condiciones adversas, como la detección de rostros pequeños o capturados a distancia mediante cámaras de videovigilancia. La funcionalidad principal está compuesta por dos funciones: train_recognizer y enhanced_recognizer_predict.
La función train_recognizer tiene como propósito entrenar un modelo de reconocimiento facial utilizando el algoritmo Local Binary Patterns Histograms (LBPH). Para ello, se recuperan los registros de personas almacenadas en la base de datos mediante el modelo Persona, gestionado por el ORM de Django. A partir de dichas instancias, se procesan las imágenes asociadas, aplicando una detección de rostros mejorada con una red neuronal convolucional (dnn_net). Una vez detectados, los rostros se convierten a escala de grises y se someten a un análisis del tamaño. En aquellos casos donde el rostro es de pequeñas dimensiones, se aplica una función de mejora (enhance_small_faces) diseñada para ampliar y refinar detalles faciales. Posteriormente, todas las imágenes son normalizadas mediante ecualización de histograma y suavizadas con un filtro bilateral, lo cual contribuye a la reducción de ruido manteniendo la nitidez de los bordes. Cada imagen procesada, junto a su versión reflejada horizontalmente, se incorpora al conjunto de entrenamiento. Finalmente, si el número de muestras es suficiente, se crea una instancia del reconocedor LBPH y se entrena el modelo con las imágenes procesadas, retornando tanto el reconocedor como un diccionario de mapeo entre identificadores numéricos y personas reales.
La segunda función, enhanced_recognizer_predict, se encarga del proceso de inferencia, es decir, la identificación de una persona a partir de un rostro detectado en tiempo de ejecución. Similar al procedimiento de entrenamiento, si el rostro es de baja resolución, se le aplica la misma técnica de mejora y los filtros previamente descritos para asegurar consistencia entre los datos de entrenamiento y de entrada. La imagen resultante se introduce en el modelo entrenado, el cual retorna una predicción en forma de etiqueta numérica y un valor de confianza asociado. Para asegurar la fiabilidad del reconocimiento, se establece un umbral dinámico ajustado al tamaño del rostro analizado: a menor tamaño del rostro, mayor es el nivel de certeza requerido para aceptar la predicción como válida. Si el nivel de confianza supera el umbral ajustado o si la etiqueta obtenida no se encuentra en el mapa de referencias, el sistema considera el rostro como “Desconocido”. Este enfoque permite optimizar el rendimiento del sistema en escenarios reales donde la calidad de las imágenes y las condiciones de captura pueden ser altamente variables. La incorporación de mejoras específicas para rostros pequeños, junto a técnicas de preprocesamiento y validación dinámica, incrementa significativamente la precisión, robustez y adaptabilidad del módulo de reconocimiento facial.
